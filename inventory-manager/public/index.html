<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Website Inventory Dashboard</title>

    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
      :root{
        --blue:#0C2C7A; --blue-soft:#2C6DFF; --gold:#E6B652;
        --ink:#0E0E0E; --muted:#4B4A46; --card-radius:18px;
        --focus-ring: 0 0 0 3px rgba(44,109,255,.22);
      }
      html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif;background:radial-gradient(1200px 780px at 50% 8%, #fff 0%, #fff 55%, rgba(12,44,122,.08) 75%, rgba(12,44,122,.16) 100%);color:var(--ink);}
      .wrap{max-width:1280px;margin:0 auto;padding:clamp(16px,4vw,32px);} header{display:flex;flex-direction:column;gap:4px;margin-bottom:14px;}
      .title{font-family:"Playfair Display",ui-serif,Georgia,serif;font-size:clamp(24px,4vw,34px);color:var(--blue);} .subtitle{color:var(--muted);font-size:14px;max-width:700px;}
      .tabs{display:flex;gap:8px;margin:8px 0 16px;flex-wrap:wrap;} .tab-btn{border:1px solid #c9d5f2;background:#fff;color:var(--blue);border-radius:999px;padding:10px 16px;font-size:13px;font-weight:600;cursor:pointer;}
      .tab-btn.active{background:var(--blue);color:#fff;border-color:var(--blue);} .tab-panel{display:none;} .tab-panel.active{display:block;}
      .summary-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:18px;}
      .card{border-radius:var(--card-radius);background:#fff;border:1px solid rgba(12,44,122,.10);box-shadow:0 18px 50px rgba(12,44,122,.10);padding:12px 14px;}
      .card h3{margin:0;font-size:12px;color:#55524c;} .card .value{margin-top:6px;font-size:20px;font-weight:700;color:var(--blue);} .card .meta{margin-top:4px;font-size:12px;color:#7e7b74;}
      .charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:20px;}
      .chart-card{border-radius:var(--card-radius);background:#fff;border:1px solid rgba(12,44,122,.10);box-shadow:0 18px 50px rgba(12,44,122,.10);padding:10px 10px 4px;display:flex;flex-direction:column;}
      .chart-title{font-size:13px;font-weight:600;color:var(--blue);margin:0 4px 6px;} .chart{width:100%;height:240px;}
      .table-card{border-radius:var(--card-radius);background:#fff;border:1px solid rgba(12,44,122,.10);box-shadow:0 18px 50px rgba(12,44,122,.10);padding:12px 14px;margin-bottom:30px;display:flex;flex-direction:column;gap:10px;}
      .table-header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;} .table-title{font-size:14px;font-weight:600;color:var(--blue);margin:0;} .table-meta{font-size:12px;color:#7f7c76;}
      .search-input,.toolbar-select,.clear-btn,.primary-btn,.secondary-btn,.cell-input{min-height:40px;padding:8px 12px;border-radius:10px;border:1px solid rgba(12,44,122,.2);background:#fff;font-size:13px;outline:none;}
      .clear-btn,.primary-btn,.secondary-btn{border-radius:999px;cursor:pointer;font-weight:600;} .primary-btn{background:var(--blue);color:#fff;border-color:var(--blue);} .secondary-btn{background:#fff;color:var(--blue);}
      .manage-toolbar{position:sticky;top:8px;z-index:4;display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:10px;border-radius:12px;background:#F8FAFF;border:1px solid #E6EAF6;}
      .toggle-wrap{display:inline-flex;gap:8px;align-items:center;font-size:13px;font-weight:500;color:#43413d;min-height:40px;padding:0 6px;} .toggle-wrap input{width:18px;height:18px;accent-color:var(--blue-soft);}
      .save-pill{display:inline-flex;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;} .save-pill.saved{background:rgba(0,128,96,.12);color:#0b6a4b;} .save-pill.saving{background:rgba(230,182,82,.2);color:#7a5a18;} .save-pill.error{background:rgba(203,63,63,.16);color:#9d1d1d;}
      .table-scroll{border-radius:14px;border:1px solid #E2E8F5;overflow:auto;max-height:460px;background:#fff;}
      table{border-collapse:separate;border-spacing:0;width:100%;min-width:1700px;font-size:13px;background:#fff;table-layout:fixed;} thead{position:sticky;top:0;z-index:2;background:#EEF2FC;}
      th,td{padding:9px 10px;border-bottom:1px solid #ECEEF7;text-align:left;vertical-align:middle;} th{font-weight:600;color:#42403b;background:#EEF2FC;}
      tbody tr:nth-child(even):not(.low){background:rgba(12,44,122,.025);} tbody tr:hover:not(.low){background:rgba(44,109,255,.08);} tbody tr.low{background:rgba(230,182,82,.08);}
      .badge-low{display:inline-flex;padding:2px 8px;border-radius:999px;background:rgba(230,182,82,.16);color:#7a5a18;font-size:11px;margin-left:4px;}
      .pill-status{display:inline-flex;padding:3px 8px;border-radius:999px;font-size:11px;font-weight:500;} .pill-status.active{background:rgba(0,128,96,.12);color:#0b6a4b;} .pill-status.inactive{background:rgba(153,153,153,.16);color:#555;}
      .pill-flag{display:inline-flex;padding:3px 8px;border-radius:999px;font-size:11px;font-weight:600;background:#eef3ff;color:#2d4b94;}
      .footer-note{font-size:12px;color:#7f7c76;} .pill-count{font-size:11px;background:#F5F6FC;border-radius:999px;padding:2px 8px;margin-left:4px;font-weight:500;}
      .cell-main{display:flex;align-items:center;gap:8px;} .thumb-img{width:52px;height:52px;border-radius:10px;object-fit:cover;box-shadow:0 6px 16px rgba(12,44,122,.18);}
      .img-placeholder{width:52px;height:52px;border-radius:10px;display:grid;place-items:center;background:radial-gradient(circle at 0 0, rgba(230,182,82,.3), rgba(12,44,122,.08));font-size:9px;color:#666;text-align:center;line-height:1.2;}
      .item-main-text{display:flex;flex-direction:column;gap:2px;min-width:180px;} .item-name{font-weight:600;} .item-meta-inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
      .type-badge{display:inline-flex;padding:2px 8px;border-radius:999px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.04em;} .type-badge.main{background:#e8f8f1;color:#0f7d58;} .type-badge.variant{background:#eef2ff;color:#364f9d;}
      .img-btn,.meta-btn{border:1px solid #d2dcf5;background:#fff;border-radius:999px;padding:5px 10px;font-size:11px;color:#28458f;cursor:pointer;}
      .editable-cell{display:flex;flex-direction:column;gap:4px;} .editable-display{border:1px solid transparent;background:transparent;border-radius:8px;padding:5px 6px;font-size:13px;text-align:left;cursor:text;}
      .editable-display:hover,.editable-display:focus-visible{border-color:#c9d5f2;background:#fff;box-shadow:0 2px 8px rgba(12,44,122,.1);} .editable-cell.error .editable-display{border-color:#c84040;background:#fff6f6;}
      .cell-state{font-size:10px;color:#6f6d67;min-height:12px;opacity:0;} .editable-cell.saving .cell-state,.editable-cell.error .cell-state,.editable-cell.saved .cell-state{opacity:1;}
      .retry-btn{max-width:max-content;border:none;background:none;color:#9d1d1d;font-size:10px;padding:0;cursor:pointer;text-decoration:underline;}
      .toggle-chip{border-radius:999px;padding:4px 10px;border:1px solid #cad7f4;background:#fff;font-size:11px;font-weight:600;color:#35529d;cursor:pointer;} .toggle-chip.on{background:#2c6dff;color:#fff;border-color:#2c6dff;}
      .muted{color:#9a988f;}
      .modal{position:fixed;inset:0;background:rgba(8,14,38,.45);display:none;align-items:center;justify-content:center;z-index:30;padding:16px;} .modal.open{display:flex;}
      .modal-card{width:min(720px,100%);background:#fff;border-radius:18px;padding:16px;border:1px solid rgba(12,44,122,.16);box-shadow:0 24px 60px rgba(11,29,77,.26);} .modal-title{margin:0 0 12px;color:var(--blue);font-size:18px;}
      .modal-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;} .modal-grid .full{grid-column:1/-1;} textarea.cell-input{min-height:90px;border-radius:12px;resize:vertical;}
      .modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px;flex-wrap:wrap;}
      .bundle-actions{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;} .empty-state{font-size:13px;color:#6f6d67;padding:14px;border:1px dashed #c9d5f2;border-radius:12px;}
      button:focus-visible,.search-input:focus-visible,.toolbar-select:focus-visible,.cell-input:focus-visible,.toggle-wrap input:focus-visible{box-shadow:var(--focus-ring);outline:none;}
      @media (max-width: 820px){.charts-grid{grid-template-columns:1fr;} .manage-toolbar{top:4px;} .modal-grid{grid-template-columns:1fr;}}
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="title">Website Inventory Overview</div>
        <div class="subtitle">Live snapshot of items assigned to the website. Manage product metadata, variants, promotions, and bundled deals from one premium dashboard.</div>
      </header>

      <div class="tabs">
        <button id="tabProducts" class="tab-btn active" type="button">Products</button>
        <button id="tabBundles" class="tab-btn" type="button">Bundles & Deals</button>
      </div>

      <section id="productsPanel" class="tab-panel active">
        <section class="summary-row">
          <article class="card"><h3>Total Website SKUs</h3><div class="value" id="totalItems">–</div><div class="meta">Active items listed for sale.</div></article>
          <article class="card"><h3>Total Stock Qty</h3><div class="value" id="totalStockQty">–</div><div class="meta">Units currently on hand.</div></article>
          <article class="card"><h3>Stock Value (JMD)</h3><div class="value" id="totalStockValue">–</div><div class="meta">Based on selling price × qty.</div></article>
          <article class="card"><h3>Low Stock Alerts</h3><div class="value" id="lowStockCount">–</div><div class="meta">Items at or below reorder level.</div></article>
        </section>

        <section class="charts-grid">
          <article class="chart-card"><h3 class="chart-title">Stock Status Breakdown</h3><div id="chartStatus" class="chart"></div></article>
          <article class="chart-card"><h3 class="chart-title">Top 10 Items by Quantity</h3><div id="chartTopQty" class="chart"></div></article>
          <article class="chart-card"><h3 class="chart-title">Top 10 Items by Stock Value (JMD)</h3><div id="chartTopValue" class="chart"></div></article>
          <article class="chart-card"><h3 class="chart-title">Reorder Risk – On Hand vs Reorder Level</h3><div id="chartReorder" class="chart"></div></article>
        </section>

        <section class="table-card">
          <div class="table-header">
            <div>
              <h3 class="table-title">Inventory Detail <span class="pill-count" id="visibleCount">0 items</span></h3>
              <div class="table-meta">Inline edit key product metadata and keep the table clean with modal editing for variants and promotions.</div>
            </div>
          </div>

          <div class="manage-toolbar">
            <input id="searchBox" class="search-input" placeholder="Search by item name or SKU…" aria-label="Search items" />
            <select id="categoryFilter" class="toolbar-select"><option value="ALL">All categories</option></select>
            <label class="toggle-wrap"><input id="mainOnlyToggle" type="checkbox" checked /><span>Main products only</span></label>
            <label class="toggle-wrap"><input id="featuredOnlyToggle" type="checkbox" /><span>Featured only</span></label>
            <label class="toggle-wrap"><input id="visibleOnlyToggle" type="checkbox" /><span>Visible only</span></label>
            <label class="toggle-wrap"><input id="saleNowToggle" type="checkbox" /><span>On sale now</span></label>
            <span id="saveStatus" class="save-pill saved">Saved</span>
            <button id="clearFiltersBtn" class="clear-btn" type="button">Clear filters</button>
          </div>

          <div class="table-scroll">
            <table id="itemsTable">
              <thead>
                <tr>
                  <th>Item & Image</th><th>SKU</th><th>On Hand</th><th>Reorder</th><th>Stock</th><th>Price</th><th>Stock value</th><th>Status</th><th>Unit</th><th>Ref ID</th>
                  <th>Category</th><th>Parent ID</th><th>Featured</th><th>Visible</th><th>Sort</th><th>Options/Promo</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="footer-note">Low stock rows are highlighted in gold. Data source: <strong>WebsiteItems</strong> sheet.</div>
        </section>
      </section>

      <section id="bundlesPanel" class="tab-panel">
        <section class="table-card">
          <div class="bundle-actions">
            <div>
              <h3 class="table-title">Bundles & Deals</h3>
              <div class="table-meta">Create and manage bundle promotions without leaving the admin dashboard.</div>
            </div>
            <button id="createBundleBtn" class="primary-btn" type="button">Create bundle</button>
          </div>
          <div class="table-scroll">
            <table id="bundlesTable" style="min-width:1200px;">
              <thead>
                <tr><th>ID</th><th>Title</th><th>SKUs</th><th>Discount</th><th>Active</th><th>Start</th><th>End</th><th>Image</th><th>Action</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="bundlesEmpty" class="empty-state" style="display:none;">No bundles yet. Create one to auto-provision the Bundles sheet.</div>
        </section>
      </section>
    </div>

    <input type="file" id="imagePicker" accept="image/*" style="display:none" />

    <div id="metaModal" class="modal" role="dialog" aria-modal="true">
      <div class="modal-card">
        <h3 class="modal-title">Variant & Promotion Settings</h3>
        <div class="modal-grid">
          <div class="full"><label>SKU</label><input id="metaSku" class="cell-input" disabled /></div>
          <div class="full"><label>Variant Options (JSON/string)</label><textarea id="metaVariantOptions" class="cell-input"></textarea></div>
          <div><label>Promo Price</label><input id="metaPromoPrice" type="number" class="cell-input" /></div>
          <div><label>Promo Start</label><input id="metaPromoStart" type="date" class="cell-input" /></div>
          <div><label>Promo End</label><input id="metaPromoEnd" type="date" class="cell-input" /></div>
        </div>
        <div class="modal-actions"><button id="closeMetaModal" type="button" class="secondary-btn">Cancel</button><button id="saveMetaModal" type="button" class="primary-btn">Save</button></div>
      </div>
    </div>

    <div id="bundleModal" class="modal" role="dialog" aria-modal="true">
      <div class="modal-card">
        <h3 id="bundleModalTitle" class="modal-title">Create bundle</h3>
        <div class="modal-grid">
          <div class="full"><label>Title</label><input id="bundleTitle" class="cell-input" /></div>
          <div class="full"><label>Description</label><textarea id="bundleDescription" class="cell-input"></textarea></div>
          <div class="full"><label>SKUs</label><select id="bundleSkus" class="cell-input" multiple style="min-height:120px"></select></div>
          <div><label>Discount Type</label><select id="bundleDiscountType" class="cell-input"><option value="percent">Percent</option><option value="amount">Amount</option></select></div>
          <div><label>Discount Value</label><input id="bundleDiscountValue" type="number" class="cell-input" /></div>
          <div><label>Start Date</label><input id="bundleStartDate" type="date" class="cell-input" /></div>
          <div><label>End Date</label><input id="bundleEndDate" type="date" class="cell-input" /></div>
          <div><label>Image URL</label><input id="bundleImageUrl" class="cell-input" /></div>
          <label class="toggle-wrap"><input id="bundleActive" type="checkbox" checked /><span>Active</span></label>
        </div>
        <div class="modal-actions"><button id="deleteBundleBtn" type="button" class="secondary-btn" style="margin-right:auto;display:none;">Delete</button><button id="closeBundleModal" type="button" class="secondary-btn">Cancel</button><button id="saveBundleModal" type="button" class="primary-btn">Save bundle</button></div>
      </div>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
